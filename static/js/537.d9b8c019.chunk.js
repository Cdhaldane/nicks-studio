"use strict";(self.webpackChunknickolamagnolia=self.webpackChunknickolamagnolia||[]).push([[537],{537:(e,t,s)=>{s.r(t),s.d(t,{default:()=>r});const r=new class{constructor(){this.dataFilePath="/newsletter-subscribers.json",this.baseUrl=window.location.origin,this.init()}async init(){try{await this.getStoredData()}catch(e){const t={subscribers:[],metadata:{created:(new Date).toISOString(),lastUpdated:null,totalSubscribers:0}};await this.saveToFile(t)}}async getStoredData(){try{const e=await fetch("".concat(this.baseUrl).concat(this.dataFilePath));if(e.ok){const t=await e.json();return console.log("\ud83d\udcc4 Fetched newsletter data from JSON file:",t),t}}catch(e){console.log("Could not fetch from JSON file, using localStorage as fallback")}try{const e=localStorage.getItem("newsletter-subscribers");return e?JSON.parse(e):null}catch(e){return console.error("Error reading stored email data:",e),null}}async saveToFile(e){try{localStorage.setItem("newsletter-subscribers",JSON.stringify(e,null,2)),console.log("\ud83d\udcdd Newsletter data updated:",e)}catch(t){throw console.error("Error saving email data:",t),new Error("Failed to save email subscription")}}downloadUpdatedFile(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"newsletter-subscribers.json";const s=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),r=URL.createObjectURL(s),a=document.createElement("a");a.href=r,a.download=t,a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(r),console.log("\ud83d\udcc1 ".concat(t," downloaded! Replace the file in /public/ to sync with frontend."))}async addSubscriber(e){try{const t=await this.getStoredData()||{subscribers:[],metadata:{created:(new Date).toISOString(),lastUpdated:null,totalSubscribers:0}};if(t.subscribers.some((t=>t.email.toLowerCase()===e.toLowerCase())))throw new Error("Email already subscribed");const s={id:this.generateId(),email:e.toLowerCase(),subscribedAt:(new Date).toISOString(),status:"active",source:"website-footer"};return t.subscribers.push(s),t.metadata.lastUpdated=(new Date).toISOString(),t.metadata.totalSubscribers=t.subscribers.length,await this.saveToFile(t),this.downloadUpdatedFile(t,"newsletter-subscribers.json"),await this.updateJSONFileStructure(t),await new Promise((e=>setTimeout(e,800))),{success:!0,message:"Successfully subscribed to newsletter",subscriber:s}}catch(t){return console.error("Error adding subscriber:",t),{success:!1,message:t.message||"Failed to subscribe. Please try again."}}}async updateJSONFileStructure(e){try{var t;console.log("\ud83d\uddc3\ufe0f JSON structure updated with new data:",{totalSubscribers:e.metadata.totalSubscribers,lastSubscriber:null===(t=e.subscribers[e.subscribers.length-1])||void 0===t?void 0:t.email})}catch(s){console.error("Error updating JSON structure:",s)}}async getSubscribers(){const e=await this.getStoredData();return e?e.subscribers:[]}async getSubscriberCount(){const e=await this.getStoredData();return e?e.metadata.totalSubscribers:0}async removeSubscriber(e){try{const t=await this.getStoredData();if(!t)return{success:!1,message:"No subscribers found"};const s=t.subscribers.length;return t.subscribers=t.subscribers.filter((t=>t.email.toLowerCase()!==e.toLowerCase())),t.subscribers.length===s?{success:!1,message:"Email not found in subscribers list"}:(t.metadata.lastUpdated=(new Date).toISOString(),t.metadata.totalSubscribers=t.subscribers.length,await this.saveToFile(t),this.downloadUpdatedFile(t,"newsletter-subscribers.json"),await this.updateJSONFileStructure(t),{success:!0,message:"Successfully unsubscribed from newsletter"})}catch(t){return console.error("Error removing subscriber:",t),{success:!1,message:"Failed to unsubscribe. Please try again."}}}async exportSubscribers(){const e=await this.getStoredData();if(!e)return null;const t={...e,exportedAt:(new Date).toISOString(),exportedBy:"EmailStorageService"};return this.downloadUpdatedFile(t,"newsletter-subscribers-export-".concat((new Date).toISOString().split("T")[0],".json")),t}async downloadCurrentData(){const e=await this.getStoredData();e&&this.downloadUpdatedFile(e,"newsletter-subscribers.json")}generateId(){return"sub_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}validateEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}getAnalytics(){const e=this.getStoredData();if(!e)return null;const t=new Date,s=new Date(t.getTime()-2592e6),r=new Date(t.getTime()-6048e5),a=e.subscribers.filter((e=>new Date(e.subscribedAt)>=s)).length,i=e.subscribers.filter((e=>new Date(e.subscribedAt)>=r)).length;return{totalSubscribers:e.metadata.totalSubscribers,recentSubscribers30d:a,recentSubscribers7d:i,lastUpdated:e.metadata.lastUpdated,created:e.metadata.created}}}}}]);
//# sourceMappingURL=537.d9b8c019.chunk.js.map